<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>ALLES!CTF 2021 Writeup - Ja5on's blog</title><meta name=Description content="This is my cool site"><meta property="og:url" content="http://CUHKJason.github.io/posts/allesctf-2021/">
<meta property="og:site_name" content="Ja5on's blog"><meta property="og:title" content="ALLES!CTF 2021 Writeup"><meta property="og:description" content="Writeup for ALLES! CTF 2021"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-09-06T14:46:10+08:00"><meta property="article:modified_time" content="2021-09-06T14:46:10+08:00"><meta property="article:tag" content="Ctf"><meta property="article:tag" content="Writeup"><meta property="article:tag" content="Web"><meta property="article:tag" content="Misc"><meta name=twitter:card content="summary"><meta name=twitter:title content="ALLES!CTF 2021 Writeup"><meta name=twitter:description content="Writeup for ALLES! CTF 2021"><meta name=twitter:site content="@tiger0806051"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=referrer content="no-referrer"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://CUHKJason.github.io/posts/allesctf-2021/><link rel=prev href=http://CUHKJason.github.io/posts/fwordctf-2021/><link rel=next href=http://CUHKJason.github.io/posts/hkcertctf-2021/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"ALLES!CTF 2021 Writeup","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/CUHKJason.github.io\/posts\/allesctf-2021\/"},"genre":"posts","keywords":"ctf, writeup, web, misc","wordcount":1776,"url":"http:\/\/CUHKJason.github.io\/posts\/allesctf-2021\/","datePublished":"2021-09-06T14:46:10+08:00","dateModified":"2021-09-06T14:46:10+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Ja5on"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Ja5on's blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/home.png data-srcset="/images/home.png, /images/home.png 1.5x, /images/home.png 2x" data-sizes=auto alt=/images/home.png title=/images/home.png></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/about/>About </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Ja5on's blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/home.png data-srcset="/images/home.png, /images/home.png 1.5x, /images/home.png 2x" data-sizes=auto alt=/images/home.png title=/images/home.png></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/about/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">ALLES!CTF 2021 Writeup</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Ja5on</a></span>&nbsp;<span class=post-category>included in <a href=/categories/ctf/><i class="far fa-folder fa-fw" aria-hidden=true></i>Ctf</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2021-09-06>2021-09-06</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1776 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;9 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#sanity-check---web-104-points>Sanity Check - Web (104 points)</a><ul><li><a href=#challenge->Challenge :</a></li><li><a href=#solution->Solution :</a></li></ul></li><li><a href=#just-serving-pages---web-144-points>J(ust)-S(erving)-P(ages) - Web (144 points)</a><ul><li><a href=#challenge--1>Challenge :</a></li><li><a href=#files->Files :</a></li><li><a href=#solution--1>Solution :</a></li></ul></li><li><a href=#entrapi---misc-415-points>EntrAPI - Misc (415 points)</a><ul><li><a href=#challenge--2>Challenge :</a></li><li><a href=#solution--2>Solution :</a></li><li><a href=#files--1>Files :</a></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=background>Background</h1><p>04 Sept 2021, 00:00 HKT â€” 05 Sept 2021, 12:00 HKT<br>Format: Jeopardy<br>Official URL: <a href=https://ctf.alles.team/ target=_blank rel="noopener noreffer">https://ctf.alles.team/</a><br>Event organizers: ALLES!<br>CTFtime: <a href=https://ctftime.org/event/1313 target=_blank rel="noopener noreffer">https://ctftime.org/event/1313</a><br>I joint <a href=https://b6a.black/ target=_blank rel="noopener noreffer">Black Bauhinia</a> in this CTF and result in the 3rd place! Hard carried by the team and learnt a lot from them. I am going to share some of the challenges below that I was able to / almost solve.</p><h1 id=challenges>Challenges</h1><h2 id=sanity-check---web-104-points>Sanity Check - Web (104 points)</h2><h3 id=challenge->Challenge :</h3><blockquote><p>You aren&rsquo;t a ðŸ¤–, right?</p></blockquote><p><img class=lazyload src=/svg/loading.min.svg data-src=https://user-images.githubusercontent.com/19466939/132280404-b671310f-e287-4ae7-89a1-c0851eb17853.png data-srcset="https://user-images.githubusercontent.com/19466939/132280404-b671310f-e287-4ae7-89a1-c0851eb17853.png, https://user-images.githubusercontent.com/19466939/132280404-b671310f-e287-4ae7-89a1-c0851eb17853.png 1.5x, https://user-images.githubusercontent.com/19466939/132280404-b671310f-e287-4ae7-89a1-c0851eb17853.png 2x" data-sizes=auto alt=https://user-images.githubusercontent.com/19466939/132280404-b671310f-e287-4ae7-89a1-c0851eb17853.png title=robot></p><h3 id=solution->Solution :</h3><p>A standard web challenge, ðŸ¤– implies to check <code>robots.txt</code>.<br>FLAG : <strong>ALLES!{1_nice_san1ty_ch3k}</strong></p><h2 id=just-serving-pages---web-144-points>J(ust)-S(erving)-P(ages) - Web (144 points)</h2><h3 id=challenge--1>Challenge :</h3><blockquote><p>What could possibly go wrong with a website that is just serving pages? ðŸ¤”</p></blockquote><p><img class=lazyload src=/svg/loading.min.svg data-src=https://user-images.githubusercontent.com/19466939/132283179-60f94868-cb9d-4167-9467-81f4668214de.png data-srcset="https://user-images.githubusercontent.com/19466939/132283179-60f94868-cb9d-4167-9467-81f4668214de.png, https://user-images.githubusercontent.com/19466939/132283179-60f94868-cb9d-4167-9467-81f4668214de.png 1.5x, https://user-images.githubusercontent.com/19466939/132283179-60f94868-cb9d-4167-9467-81f4668214de.png 2x" data-sizes=auto alt=https://user-images.githubusercontent.com/19466939/132283179-60f94868-cb9d-4167-9467-81f4668214de.png title=home></p><h3 id=files->Files :</h3><p><a href=/files/ALLES/deployment.zip rel>deployment.zip</a></p><h3 id=solution--1>Solution :</h3><p>A JSP web challenge which will display the flag at home page if you are admin, with the relevant code in <code>home.jsp</code> as shown below:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;% if(user.getIsAdmin()){ 
</span></span><span class=line><span class=cl> ServletContext sc = request.getServletContext();
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> out.println(&#34;Your flag is: &#34;); 
</span></span><span class=line><span class=cl> out.println(sc.getAttribute(&#34;FLAG&#34;));
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>else {
</span></span><span class=line><span class=cl> out.println(&#34;No flag for you :(&#34;); 
</span></span><span class=line><span class=cl>}%&gt;</span></span></code></pre></div></div><p>After some analysis on the logic (<code>main.js</code>), the app would store the password in <code>MD5(password)</code> during registration, and send the password in the format <code>SHA1(MD5(password))</code> during login:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>function pwd_handler_login(form)
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>        if (form.password.value != &#39;&#39;)
</span></span><span class=line><span class=cl>        {
</span></span><span class=line><span class=cl>            form.password.value = CryptoJS.MD5(form.password.value).toString();
</span></span><span class=line><span class=cl>            form.password.value = CryptoJS.SHA1(form.password.value).toString();
</span></span><span class=line><span class=cl>            console.log(form.password.value);
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>function pwd_handler_registration(form)
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>        if (form.password.value != &#39;&#39;)
</span></span><span class=line><span class=cl>        {
</span></span><span class=line><span class=cl>            form.password.value = CryptoJS.MD5(form.password.value).toString();
</span></span><span class=line><span class=cl>            console.log(form.password.value);
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>}</span></span></code></pre></div></div><p>Also, the login handling logic is under <code>UserLoginServlet.java</code> which will call <code>userDao.checkLogin</code> instead. I deployed the app and tested locally and observed a weird thing after set the debug mode that I could not login even providing a &ldquo;correct&rdquo; password ðŸ¤”<br><img class=lazyload src=/svg/loading.min.svg data-src=https://user-images.githubusercontent.com/19466939/132283438-60a2a9f0-e80b-442f-9956-06a9b9cf85a4.png data-srcset="https://user-images.githubusercontent.com/19466939/132283438-60a2a9f0-e80b-442f-9956-06a9b9cf85a4.png, https://user-images.githubusercontent.com/19466939/132283438-60a2a9f0-e80b-442f-9956-06a9b9cf85a4.png 1.5x, https://user-images.githubusercontent.com/19466939/132283438-60a2a9f0-e80b-442f-9956-06a9b9cf85a4.png 2x" data-sizes=auto alt=https://user-images.githubusercontent.com/19466939/132283438-60a2a9f0-e80b-442f-9956-06a9b9cf85a4.png title=login><br>Turns out from the <code>UserDAO.java</code>, we can notice the following vulnerable code:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>// User password in storage is only stored as md5, we should hash it again
</span></span><span class=line><span class=cl>MessageDigest digestStorage;
</span></span><span class=line><span class=cl>digestStorage = MessageDigest.getInstance(&#34;SHA-1&#34;);
</span></span><span class=line><span class=cl>digestStorage.update(u.getPassword().getBytes(&#34;ascii&#34;));
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>byte[] passwordBytes = null;
</span></span><span class=line><span class=cl>try {
</span></span><span class=line><span class=cl> passwordBytes = Hex.decodeHex(password_md5_sha1);
</span></span><span class=line><span class=cl>} catch (DecoderException e) {
</span></span><span class=line><span class=cl> return null;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>UserConfig userConfig = (UserConfig) request.getSession().getAttribute(&#34;config&#34;);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>if (userConfig.isDebugMode()) {
</span></span><span class=line><span class=cl> String pw1 = new String(Hex.encodeHex(digestStorage.digest()));
</span></span><span class=line><span class=cl> String pw2 = password_md5_sha1;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> java.util.logging.Logger.getLogger(&#34;login&#34;)
</span></span><span class=line><span class=cl>   .info(String.format(&#34;Login tried with: %s == %s&#34;, pw1, pw2));
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>if (Arrays.equals(passwordBytes, digestStorage.digest())) {
</span></span><span class=line><span class=cl> if (userConfig.isDebugMode())
</span></span><span class=line><span class=cl>  java.util.logging.Logger.getLogger(&#34;login&#34;).info(&#34;Passwords were equal&#34;);
</span></span><span class=line><span class=cl> return u;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>if (userConfig.isDebugMode())
</span></span><span class=line><span class=cl> java.util.logging.Logger.getLogger(&#34;login&#34;).info(&#34;Passwords were NOT equal&#34;);</span></span></code></pre></div></div><p>The server would check if the provided password (in SHA1 format already) is equal to SHA1 of stored password or not, which seems legitimate. However, if it&rsquo;s in the debug mode, The <code>digest</code> method was called before the real checking and from the documentation of the Class <a href=https://docs.oracle.com/javase/7/docs/api/java/security/MessageDigest.html target=_blank rel="noopener noreffer">MessageDiges</a>, it stated that</p><blockquote><p>The digest method can be called once for a given number of updates. After digest has been called, the MessageDigest object is reset to its initialized state.</p></blockquote><p>Therefore the <code>passwordBytes</code> is comparing with SHA1 of empty string instead of the real password, thus we can provide the hash <code>da39a3ee5e6b4b0d3255bfef95601890afd80709</code> and login as admin to get the flag.</p><p><strong>Solve:</strong></p><ol><li><p>Set Debug Mode:
<code>curl 'https://[challenge]/config' -H 'Cookie: JSESSIONID=[...]' -X POST --data '{"debugMode":true}'</code><br><img class=lazyload src=/svg/loading.min.svg data-src=https://user-images.githubusercontent.com/19466939/132283104-5d074bde-e5cc-4f3a-a927-ac5536594ef3.png data-srcset="https://user-images.githubusercontent.com/19466939/132283104-5d074bde-e5cc-4f3a-a927-ac5536594ef3.png, https://user-images.githubusercontent.com/19466939/132283104-5d074bde-e5cc-4f3a-a927-ac5536594ef3.png 1.5x, https://user-images.githubusercontent.com/19466939/132283104-5d074bde-e5cc-4f3a-a927-ac5536594ef3.png 2x" data-sizes=auto alt=https://user-images.githubusercontent.com/19466939/132283104-5d074bde-e5cc-4f3a-a927-ac5536594ef3.png title=config></p></li><li><p>Login as admin:
<code>curl 'https://[challenge]/login' -H 'Cookie: JSESSIONID=[...]' -X POST --data 'username=admin&amp;password=da39a3ee5e6b4b0d3255bfef95601890afd80709'</code><br><img class=lazyload src=/svg/loading.min.svg data-src=https://user-images.githubusercontent.com/19466939/132283147-6f4eb086-3b0f-4fb4-a5c2-717348ba3709.png data-srcset="https://user-images.githubusercontent.com/19466939/132283147-6f4eb086-3b0f-4fb4-a5c2-717348ba3709.png, https://user-images.githubusercontent.com/19466939/132283147-6f4eb086-3b0f-4fb4-a5c2-717348ba3709.png 1.5x, https://user-images.githubusercontent.com/19466939/132283147-6f4eb086-3b0f-4fb4-a5c2-717348ba3709.png 2x" data-sizes=auto alt=https://user-images.githubusercontent.com/19466939/132283147-6f4eb086-3b0f-4fb4-a5c2-717348ba3709.png title=admin></p></li></ol><p>FLAG : <strong>ALLES!{ohh-b0y-java-y-u-do-th1s-t0-m3???!?}</strong></p><p>Thanks to Mystiz, ozetta and TWY for brainstorming together</p><h2 id=entrapi---misc-415-points>EntrAPI - Misc (415 points)</h2><h3 id=challenge--2>Challenge :</h3><blockquote><p>A very simple stegano tool that estimates the entropy of sections of a file by counting unique bytes in a range. Here&rsquo;s a snippet of the Dockerfile to get you started:<br><code>COPY main.js index.html flag /</code><br><code>RUN deno cache main.js</code><br><code>EXPOSE 1024</code><br><code>CMD deno run -A main.js</code><br>Happy guessing! :^)</p></blockquote><p><img class=lazyload src=/svg/loading.min.svg data-src=https://user-images.githubusercontent.com/19466939/132284620-d08757d3-9c52-4414-b783-c355426f8111.png data-srcset="https://user-images.githubusercontent.com/19466939/132284620-d08757d3-9c52-4414-b783-c355426f8111.png, https://user-images.githubusercontent.com/19466939/132284620-d08757d3-9c52-4414-b783-c355426f8111.png 1.5x, https://user-images.githubusercontent.com/19466939/132284620-d08757d3-9c52-4414-b783-c355426f8111.png 2x" data-sizes=auto alt=https://user-images.githubusercontent.com/19466939/132284620-d08757d3-9c52-4414-b783-c355426f8111.png title=home></p><h3 id=solution--2>Solution :</h3><p>This is the most interesting challenge in this CTF in my opinion and we spent around 12 hours to solve this (and got the first blood).
From the description we knew the three key files filename and the app is run with <code>deno</code>. The webpage is simple, visualizing the entropy of the selected sections of the file:
<img class=lazyload src=/svg/loading.min.svg data-src=https://user-images.githubusercontent.com/19466939/132284646-164f2323-cae0-4c1e-8076-0d9933beb4bb.png data-srcset="https://user-images.githubusercontent.com/19466939/132284646-164f2323-cae0-4c1e-8076-0d9933beb4bb.png, https://user-images.githubusercontent.com/19466939/132284646-164f2323-cae0-4c1e-8076-0d9933beb4bb.png 1.5x, https://user-images.githubusercontent.com/19466939/132284646-164f2323-cae0-4c1e-8076-0d9933beb4bb.png 2x" data-sizes=auto alt=https://user-images.githubusercontent.com/19466939/132284646-164f2323-cae0-4c1e-8076-0d9933beb4bb.png title=output></p><p>By reading the source code of <code>index.html</code>, we can understand the <code>/query</code> function is similar to <code>len(set(f.open("path").read()[start:end]))</code> in Python.</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=n>rangeEntropy</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>const</span> <span class=n>response</span> <span class=o>=</span> <span class=n>await</span> <span class=n>fetch</span><span class=p>(</span><span class=s2>&#34;/query&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>method</span><span class=p>:</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>headers</span><span class=p>:</span> <span class=p>{</span> <span class=s1>&#39;Content-Type&#39;</span><span class=p>:</span> <span class=s1>&#39;application/json&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=n>body</span><span class=p>:</span> <span class=n>JSON</span><span class=o>.</span><span class=n>stringify</span><span class=p>({</span> <span class=n>path</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>end</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>                <span class=p>})</span>
</span></span><span class=line><span class=cl>                <span class=n>rangeEntropy</span> <span class=o>=</span> <span class=p>(</span><span class=n>await</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>())[</span><span class=s2>&#34;range-entropy&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>start</span> <span class=o>+=</span> <span class=n>BLOCK_SIZE</span>
</span></span><span class=line><span class=cl>                <span class=n>end</span> <span class=o>+=</span> <span class=n>BLOCK_SIZE</span>
</span></span><span class=line><span class=cl>                <span class=n>console</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=err>`</span><span class=o>$</span><span class=p>{</span><span class=n>start</span><span class=p>}</span><span class=o>-$</span><span class=p>{</span><span class=n>end</span><span class=p>}:</span> <span class=o>$</span><span class=p>{</span><span class=n>rangeEntropy</span><span class=p>}</span> <span class=n>unique</span> <span class=n>bytes</span><span class=err>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>document</span><span class=o>.</span><span class=n>getElementById</span><span class=p>(</span><span class=s2>&#34;output&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>textContent</span> <span class=o>+=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span><span class=o>.</span><span class=n>repeat</span><span class=p>(</span><span class=n>rangeEntropy</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span></span></span></code></pre></div></div><p>This challenge reminds me on some algorithm relating to finding substrings or something else. Also, as we know that the flag is in the format of <code>ALLES!{...}</code>, we do know the actually entropy from [0..7] of <code>/flag</code>.
My first thought is to identify the duplicated character by going throught different sections of the file and observing the change of the entropy. Below I will try to illustrate the idea step by step:</p><ol><li>First, <code>CL</code> and <code>CR</code> are 0 and <code>Entropy</code> is 1 obviously.<br><img class=lazyload src=/svg/loading.min.svg data-src=https://user-images.githubusercontent.com/19466939/132295104-23b4e565-81a6-4ddd-93c0-abcce09922df.png data-srcset="https://user-images.githubusercontent.com/19466939/132295104-23b4e565-81a6-4ddd-93c0-abcce09922df.png, https://user-images.githubusercontent.com/19466939/132295104-23b4e565-81a6-4ddd-93c0-abcce09922df.png 1.5x, https://user-images.githubusercontent.com/19466939/132295104-23b4e565-81a6-4ddd-93c0-abcce09922df.png 2x" data-sizes=auto alt=https://user-images.githubusercontent.com/19466939/132295104-23b4e565-81a6-4ddd-93c0-abcce09922df.png title=a></li><li>Next, <code>CR</code> is increased by 1 and <code>Entropy</code> is also increased by 1, meaning a new character is found.<br><img class=lazyload src=/svg/loading.min.svg data-src=https://user-images.githubusercontent.com/19466939/132295109-0323f323-4a4a-46fa-9499-6e1d5fc55165.png data-srcset="https://user-images.githubusercontent.com/19466939/132295109-0323f323-4a4a-46fa-9499-6e1d5fc55165.png, https://user-images.githubusercontent.com/19466939/132295109-0323f323-4a4a-46fa-9499-6e1d5fc55165.png 1.5x, https://user-images.githubusercontent.com/19466939/132295109-0323f323-4a4a-46fa-9499-6e1d5fc55165.png 2x" data-sizes=auto alt=https://user-images.githubusercontent.com/19466939/132295109-0323f323-4a4a-46fa-9499-6e1d5fc55165.png title=b></li><li>Next, <code>CR</code> is increased by 1 again but <code>Entropy</code> remain unchanged. This implies a duplicated character is found.<br><img class=lazyload src=/svg/loading.min.svg data-src=https://user-images.githubusercontent.com/19466939/132295112-bd997eeb-c9b5-40a6-a5eb-5850bfed49e5.png data-srcset="https://user-images.githubusercontent.com/19466939/132295112-bd997eeb-c9b5-40a6-a5eb-5850bfed49e5.png, https://user-images.githubusercontent.com/19466939/132295112-bd997eeb-c9b5-40a6-a5eb-5850bfed49e5.png 1.5x, https://user-images.githubusercontent.com/19466939/132295112-bd997eeb-c9b5-40a6-a5eb-5850bfed49e5.png 2x" data-sizes=auto alt=https://user-images.githubusercontent.com/19466939/132295112-bd997eeb-c9b5-40a6-a5eb-5850bfed49e5.png title=c><br>3.5 You can see the <code>Entropy</code> should be increased by 1 if there&rsquo;s no duplicated character.<br><img class=lazyload src=/svg/loading.min.svg data-src=https://user-images.githubusercontent.com/19466939/132295113-061e88e9-2121-42a9-9cd6-cf80cd917d9c.png data-srcset="https://user-images.githubusercontent.com/19466939/132295113-061e88e9-2121-42a9-9cd6-cf80cd917d9c.png, https://user-images.githubusercontent.com/19466939/132295113-061e88e9-2121-42a9-9cd6-cf80cd917d9c.png 1.5x, https://user-images.githubusercontent.com/19466939/132295113-061e88e9-2121-42a9-9cd6-cf80cd917d9c.png 2x" data-sizes=auto alt=https://user-images.githubusercontent.com/19466939/132295113-061e88e9-2121-42a9-9cd6-cf80cd917d9c.png title=d></li><li>We fix <code>CR</code> and increase <code>CL</code> by 1. The <code>Entropy</code> should decrease by 1.<br><img class=lazyload src=/svg/loading.min.svg data-src=https://user-images.githubusercontent.com/19466939/132295115-52b969c8-7ca2-450c-bcfb-5968f04b8b2b.png data-srcset="https://user-images.githubusercontent.com/19466939/132295115-52b969c8-7ca2-450c-bcfb-5968f04b8b2b.png, https://user-images.githubusercontent.com/19466939/132295115-52b969c8-7ca2-450c-bcfb-5968f04b8b2b.png 1.5x, https://user-images.githubusercontent.com/19466939/132295115-52b969c8-7ca2-450c-bcfb-5968f04b8b2b.png 2x" data-sizes=auto alt=https://user-images.githubusercontent.com/19466939/132295115-52b969c8-7ca2-450c-bcfb-5968f04b8b2b.png title=e></li><li>Next, <code>CL</code> is increased by 1 but <code>Entropy</code> remain unchanged. This implies we found the duplicate character position.<br><img class=lazyload src=/svg/loading.min.svg data-src=https://user-images.githubusercontent.com/19466939/132295118-24584e37-ef8d-49d3-9b6b-25fd1b1866d0.png data-srcset="https://user-images.githubusercontent.com/19466939/132295118-24584e37-ef8d-49d3-9b6b-25fd1b1866d0.png, https://user-images.githubusercontent.com/19466939/132295118-24584e37-ef8d-49d3-9b6b-25fd1b1866d0.png 1.5x, https://user-images.githubusercontent.com/19466939/132295118-24584e37-ef8d-49d3-9b6b-25fd1b1866d0.png 2x" data-sizes=auto alt=https://user-images.githubusercontent.com/19466939/132295118-24584e37-ef8d-49d3-9b6b-25fd1b1866d0.png title=f></li></ol><p>The whole process is illustrated by the flowchart below, with my PoC to find the duplicated character position (ðŸš¨poor code warningðŸš¨):
<img class=lazyload src=/svg/loading.min.svg data-src=https://user-images.githubusercontent.com/19466939/132293423-1c6e6e58-64f6-45c3-853c-4b8b6e1ebdf5.png data-srcset="https://user-images.githubusercontent.com/19466939/132293423-1c6e6e58-64f6-45c3-853c-4b8b6e1ebdf5.png, https://user-images.githubusercontent.com/19466939/132293423-1c6e6e58-64f6-45c3-853c-4b8b6e1ebdf5.png 1.5x, https://user-images.githubusercontent.com/19466939/132293423-1c6e6e58-64f6-45c3-853c-4b8b6e1ebdf5.png 2x" data-sizes=auto alt=https://user-images.githubusercontent.com/19466939/132293423-1c6e6e58-64f6-45c3-853c-4b8b6e1ebdf5.png title=flow></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>import</span> <span class=n>requests</span><span class=p>,</span> <span class=n>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>req</span> <span class=p>(</span><span class=n>cl</span><span class=p>,</span> <span class=n>cr</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>requests</span><span class=o>.</span><span class=n>adapters</span><span class=o>.</span><span class=n>DEFAULT_RETRIES</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>		<span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;content-type&#39;</span><span class=p>:</span> <span class=s1>&#39;application/json&#39;</span><span class=p>,</span> <span class=s1>&#39;user-agent&#39;</span><span class=p>:</span> <span class=s1>&#39;slow connection&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>datas</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;path&#34;</span><span class=p>:</span><span class=s2>&#34;/flag&#34;</span><span class=p>,</span><span class=s2>&#34;start&#34;</span><span class=p>:</span><span class=n>cl</span><span class=p>,</span> <span class=s2>&#34;end&#34;</span><span class=p>:</span><span class=n>cr</span><span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[ ] Trying to call path=/flag, start=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>cl</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;, end=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>cr</span><span class=p>))</span>
</span></span><span class=line><span class=cl>		<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s1>&#39;https://[challenge]/query&#39;</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>datas</span><span class=p>),</span> <span class=n>headers</span> <span class=o>=</span> <span class=n>headers</span><span class=p>,</span> <span class=n>timeout</span> <span class=o>=</span> <span class=mi>15</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>)[</span><span class=s1>&#39;range-entropy&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>	<span class=n>except</span> <span class=n>Exception</span> <span class=n>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[!] Failed. Retrying...&#34;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>req</span><span class=p>(</span><span class=n>cl</span><span class=p>,</span> <span class=n>cr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>109</span><span class=p>)]</span> 
</span></span><span class=line><span class=cl><span class=n>cl</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>cr</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>upper</span> <span class=o>=</span> <span class=mi>108</span>
</span></span><span class=line><span class=cl><span class=n>entropy</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>entropy2</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>cr</span> <span class=o>&lt;=</span> <span class=n>upper</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=n>cl</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>	<span class=n>tmp</span> <span class=o>=</span> <span class=n>req</span><span class=p>(</span><span class=n>cl</span><span class=p>,</span> <span class=n>cr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] cl, cr, entropy&#34;</span><span class=p>,</span> <span class=n>cl</span><span class=p>,</span> <span class=n>cr</span><span class=p>,</span> <span class=n>tmp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=n>entropy</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>!=</span> <span class=n>tmp</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] Found duplicate&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>cl</span> <span class=o>=</span> <span class=n>cl</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>		<span class=n>entropy2</span> <span class=o>=</span> <span class=n>entropy</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span> <span class=n>cl</span> <span class=o>&lt;=</span> <span class=n>cr</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>tmp</span> <span class=o>=</span> <span class=n>req</span><span class=p>(</span><span class=n>cl</span><span class=p>,</span> <span class=n>cr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] cl, cr, entropy&#34;</span><span class=p>,</span> <span class=n>cl</span><span class=p>,</span> <span class=n>cr</span><span class=p>,</span> <span class=n>tmp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=p>(</span><span class=n>entropy2</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>!=</span> <span class=n>tmp</span><span class=p>):</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=p>(</span><span class=n>flag</span><span class=p>[</span><span class=n>cl</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>cl</span><span class=p>,</span> <span class=n>cr</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>					<span class=n>entropy2</span> <span class=o>=</span> <span class=n>entropy2</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>				<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>					<span class=n>flag</span><span class=p>[</span><span class=n>cl</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>cr</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>					<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] Updating position...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>					<span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>					<span class=n>entropy</span> <span class=o>=</span> <span class=n>entropy</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>					<span class=k>break</span>
</span></span><span class=line><span class=cl>			<span class=n>cl</span> <span class=o>=</span> <span class=n>cl</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>			<span class=n>entropy2</span> <span class=o>=</span> <span class=n>entropy2</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>	<span class=n>cr</span> <span class=o>=</span> <span class=n>cr</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>	<span class=n>entropy</span> <span class=o>=</span> <span class=n>entropy</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span></span></span></code></pre></div></div><p>The result is <code>[92, 2, 0, 0, 93, 0, 0, 10, 33, 12, 20, 19, 23, 29, 22, 82, 30, 40, 77, 27, 24, 36, 35, 26, 50, 63, 34, 51, 67, 31, 65, 39, 0, 44, 37, 73, 45, 46, 0, 72, 61, 0, 47, 57, 59, 54, 48, 0, 52, 98, 68, 53, 56, 74, 55, 58, 62, 0, 64, 60, 80, 78, 66, 0, 76, 75, 71, 70, 0, 0, 0, 79, 81, 0, 85, 83, 0, 0, 0, 0, 86, 84, 0, 101, 0, 0, 0, 0, 102, 0, 91, 0, 0, 0, 100, 104, 0, 0, 0, 105, 0, 0, 0, 106, 0, 0, 0, 0, 0]</code>, or in this way for the first few characters: <code>[0 1 1 2 3 4]</code> (recall the flag format is <code>ALLE!{...</code>.<br>However we can see the first few characters that we knew are not showing up in the later part of the flag frequently. We failed to recover the flag directly&mldr;<br>The next thing we tried is to leak the source code of <code>main.js</code>, with the result <code>[0, 1, 2, 3, 4, 5, 6, 7, 6, 8, 2, 2, 9, 0, 10, 11, 5, 12, 3, ...</code>. As we know it is a javascript file using deno, usually it should be in the format of <code>import library</code> or <code>import { method } from library</code>. From the result pattern we can conclude the first line is <code>import { ?pp?i??t?o...</code>. After checking some <a href=https://javascript-conference.com/blog/deno-the-end-of-node-js/ target=_blank rel="noopener noreffer">examples</a> of deno, we can deduce the first line of code should be <code>import { Application, Router } from "https://deno.land/x/oak@v?.?.?/mod.ts";</code> with the unknown numeric version. With the updated PoC below, we were able to recover part of (only the char in the group <code>mp</code> below) the <code>main.js</code> and with some guessing manually, whole <code>main.js</code> &ldquo;theoretically&rdquo;.</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>import requests
</span></span><span class=line><span class=cl>session = requests.Session()
</span></span><span class=line><span class=cl>SID = &#39;xxx&#39;
</span></span><span class=line><span class=cl>cached = {}
</span></span><span class=line><span class=cl>def req(fn, start, end):
</span></span><span class=line><span class=cl>    ...&lt;snip&gt;...
</span></span><span class=line><span class=cl>length = 1660
</span></span><span class=line><span class=cl>fn = &#39;/main.js&#39;
</span></span><span class=line><span class=cl>group = [None for _ in range(length)]
</span></span><span class=line><span class=cl>gid = 0
</span></span><span class=line><span class=cl># Init
</span></span><span class=line><span class=cl>i0 = -1
</span></span><span class=line><span class=cl># Intermediate states
</span></span><span class=line><span class=cl>i0 = 62
</span></span><span class=line><span class=cl>group = [0, 1, 2, 3, 4, 5, 6, 7, 6, 8, 2, 2, 9, 0, 10, 11, 5, 0, 3, 12, 13, 6, 14, 3, 15, 5, 16, 4, 6, 17, 6, 18, 4, 3, 1, 6, 19, 20, 5, 5, 2, 21, 22, 23, 23, 24, 16, 12, 3, 25, 9, 11, 12, 24, 23, 26, 23, 3, 11, 27, 28, 29, None, None, None, None, ...&lt;snip&gt;..., None]
</span></span><span class=line><span class=cl>gid = 30
</span></span><span class=line><span class=cl>mp = {None: &#39;?&#39;,0:  &#39;i&#39;,1:  &#39;m&#39;,2:  &#39;p&#39;,3:  &#39;o&#39;,4:  &#39;r&#39;,5:  &#39;t&#39;,6:  &#39; &#39;,7:  &#39;{&#39;,8:  &#39;A&#39;,9:  &#39;l&#39;,10: &#39;c&#39;,11: &#39;a&#39;,12: &#39;n&#39;,13: &#39;,&#39;,17: &#39;}&#39;,18: &#39;f&#39;,19: &#39;&#34;&#39;,14: &#39;R&#39;,15: &#39;u&#39;,16: &#39;e&#39;,20: &#39;h&#39;,21: &#39;s&#39;,22: &#39;:&#39;,23: &#39;/&#39;,24: &#39;d&#39;,25: &#39;.&#39;,26: &#39;x&#39;,27: &#39;k&#39;,28: &#39;@&#39;,29: &#39;v&#39;}
</span></span><span class=line><span class=cl>last_occurance = {}
</span></span><span class=line><span class=cl>for i in range(i0):
</span></span><span class=line><span class=cl>    last_occurance[group[i]] = [i, group[i]]
</span></span><span class=line><span class=cl>for i in range(i0, length):
</span></span><span class=line><span class=cl>    if req(fn, 0, i) != req(fn, 0, i+1):
</span></span><span class=line><span class=cl>        # This is a new character!
</span></span><span class=line><span class=cl>        print(&#34;[*] Found new character&#34;)
</span></span><span class=line><span class=cl>        group[i] = gid
</span></span><span class=line><span class=cl>        gid += 1
</span></span><span class=line><span class=cl>    else:
</span></span><span class=line><span class=cl>        # Linear Search
</span></span><span class=line><span class=cl>        items = sorted(list(last_occurance.values()))
</span></span><span class=line><span class=cl>        l, r = 0, len(items)
</span></span><span class=line><span class=cl>        while l+1 &lt; r:
</span></span><span class=line><span class=cl>            if req(fn, items[l][0], i+1) == req(fn, items[l][0]+1, i+1) + 1:
</span></span><span class=line><span class=cl>                l = l + 1
</span></span><span class=line><span class=cl>            else:
</span></span><span class=line><span class=cl>                # found duplicate char
</span></span><span class=line><span class=cl>                group[i] = items[l][1]
</span></span><span class=line><span class=cl>                break
</span></span><span class=line><span class=cl>    last_occurance[group[i]] = [i, group[i]]
</span></span><span class=line><span class=cl>    recov = &#39;&#39;.join([mp.get(g, &#39; &#39;) for g in group])
</span></span><span class=line><span class=cl>    print(&#39;i0 =&#39;, i)
</span></span><span class=line><span class=cl>    print(&#39;group =&#39;, group)
</span></span><span class=line><span class=cl>    print(&#39;gid =&#39;, gid)
</span></span><span class=line><span class=cl>    print(&#39;-------&#39;)
</span></span><span class=line><span class=cl>    print(recov)
</span></span><span class=line><span class=cl>    print(&#39;-------&#39;)
</span></span><span class=line><span class=cl>    print()</span></span></code></pre></div></div><p><em>During the competition, Mystiz implemented another PoC with request.session and binary search in order to improve the efficiency of recovering the content. For the real solution, please wait for the writeup from Mystiz and I will update the link here later.</em></p><p>In particular, there is a GET request for getting the flag ( btw we were very excited after retrieving the first line of this code segment but then received the message <code>go away</code>) and basically we tried to crack all combination of the possible hashes to obtain the pass <code>e7552d9b7c9a01fad1c37e452af4ac95 md5 gibflag</code></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>router</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/flag&#34;</span><span class=p>,</span> <span class=n>async</span> <span class=p>(</span><span class=n>ctx</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>auth</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;authorization&#39;</span><span class=p>)</span> <span class=o>||</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>hasher</span> <span class=o>=</span> <span class=n>createHash</span><span class=p>(</span><span class=s2>&#34;md5&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>hasher</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>auth</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=o>//</span> <span class=n>NOTE</span><span class=p>:</span> <span class=n>this</span> <span class=n>is</span> <span class=n>stupid</span> <span class=ow>and</span> <span class=n>annoying</span><span class=o>.</span> <span class=n>remove</span><span class=err>?</span>
</span></span><span class=line><span class=cl>  <span class=o>//</span> <span class=n>FIXME</span><span class=err>?</span> <span class=n>crackstation</span><span class=o>.</span><span class=n>net</span> <span class=n>knows</span> <span class=n>this</span> <span class=nb>hash</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>hasher</span><span class=o>.</span><span class=n>toString</span><span class=p>(</span><span class=s2>&#34;hex&#34;</span><span class=p>)</span> <span class=o>===</span> <span class=s2>&#34;e(39)552d(63)b(39)c(63)a01fad1c3(39)e452af4ac(63)5&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ctx</span><span class=o>.</span><span class=n>response</span><span class=o>.</span><span class=n>body</span> <span class=o>=</span> <span class=n>await</span> <span class=n>Deno</span><span class=o>.</span><span class=n>readTextFile</span><span class=p>(</span><span class=s2>&#34;flag&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ctx</span><span class=o>.</span><span class=n>response</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=mi>403</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>ctx</span><span class=o>.</span><span class=n>response</span><span class=o>.</span><span class=n>body</span> <span class=o>=</span> <span class=s1>&#39;go away&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div></div><p>Thanks to Mystiz, harrier and cdemirer for brainstorming together during midnight :P</p><p>FLAG : <strong>ALLES!{is_it_encryption_if_there&rsquo;s_no_key?also_a_bit_too_lossy_for_high_entropy_secrets:MRPPASQHX3b0QrMWH0WF}</strong></p><h3 id=files--1>Files :</h3><p><a href=/files/ALLES/EntrAPI.zip rel>EntrAPI.zip</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2021-09-06</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on X" data-sharer=x data-url=http://CUHKJason.github.io/posts/allesctf-2021/ data-title="ALLES!CTF 2021 Writeup" data-via=tiger0806051 data-hashtags=ctf,writeup,web,misc><i class="fab fa-x-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Threads" data-sharer=threads data-url=http://CUHKJason.github.io/posts/allesctf-2021/ data-title="ALLES!CTF 2021 Writeup"><i class="fab fa-threads fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=http://CUHKJason.github.io/posts/allesctf-2021/ data-hashtag=ctf><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=http://CUHKJason.github.io/posts/allesctf-2021/ data-title="ALLES!CTF 2021 Writeup"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=http://CUHKJason.github.io/posts/allesctf-2021/ data-title="ALLES!CTF 2021 Writeup"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@14.9.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on å¾®åš" data-sharer=weibo data-url=http://CUHKJason.github.io/posts/allesctf-2021/ data-title="ALLES!CTF 2021 Writeup"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Diaspora" data-sharer=diaspora data-url=http://CUHKJason.github.io/posts/allesctf-2021/ data-title="ALLES!CTF 2021 Writeup" data-description><i class="fab fa-diaspora fa-fw" aria-hidden=true></i></a><a href="https://t.me/share/url?url=http%3a%2f%2fCUHKJason.github.io%2fposts%2fallesctf-2021%2f&amp;text=ALLES%21CTF%202021%20Writeup" target=_blank title="Share on Telegram"><i class="fab fa-telegram fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/ctf/>Ctf</a>,&nbsp;<a href=/tags/writeup/>Writeup</a>,&nbsp;<a href=/tags/web/>Web</a>,&nbsp;<a href=/tags/misc/>Misc</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/fwordctf-2021/ class=prev rel=prev title="FwordCTF 2021 Writeup"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>FwordCTF 2021 Writeup</a>
<a href=/posts/hkcertctf-2021/ class=next rel=next title="HKCERTCTF 2021 Writeup">HKCERTCTF 2021 Writeup<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.1-DEV"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Ja5on</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i></a></div><div id=fixed-buttons-hidden><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js></script><script>window.config={comment:{}}</script><script src=/js/theme.min.js></script></body></html>